(this["webpackJsonpcontent-sale-system"]=this["webpackJsonpcontent-sale-system"]||[]).push([[0],{38:function(e,t,c){},56:function(e,t,c){},58:function(e,t,c){},63:function(e,t,c){},64:function(e,t,c){},66:function(e,t,c){},67:function(e,t,c){},68:function(e,t,c){},69:function(e,t,c){"use strict";c.r(t);var n=c(1),a=c.n(n),s=c(31),r=c.n(s),i=(c(38),c(5)),l=c(7),j=c(3),u=c(14),d=c(6),o=c.n(d),b={list:function(){return o.a.get("/product",{withCredentials:!0}).then((function(e){return e.data}))},getProductDetail:function(e){return o.a.get("/product/".concat(e),{withCredentials:!0}).then((function(e){return e.data}))},editProduct:function(e){return o.a.post("/product",e,{withCredentials:!0}).then((function(e){return e.data}))},delete:function(e){return o.a.delete("/product/".concat(e),{withCredentials:!0}).then((function(e){return e.data}))}},h={BUYER:"BUYER",SELLER:"SELLER"},O=(c(56),c(0));var p=function(e){var t=e.user,c=Object(n.useState)(!1),a=Object(i.a)(c,2),s=a[0],r=a[1],l=Object(n.useState)([]),j=Object(i.a)(l,2),d=j[0],o=j[1];return Object(n.useEffect)((function(){b.list().then((function(e){return o(e.data)}))}),[]),Object(O.jsxs)("div",{className:"p-container",children:[Object(O.jsx)("div",{className:"tab",children:Object(O.jsxs)("ul",{children:[Object(O.jsx)("li",{className:"sel"+(s?"":" active"),onClick:function(){return r(!1)},children:"\u6240\u6709\u5185\u5bb9"}),Object(O.jsx)("li",{className:"sel"+(s?" active":""),onClick:function(){return r(!0)},children:t&&t.userType===h.SELLER?"\u672a\u552e\u51fa\u7684\u5185\u5bb9":"\u672a\u8d2d\u4e70\u7684\u5185\u5bb9"})]})}),Object(O.jsx)("div",{className:"p-list",children:Object(O.jsx)("ul",{children:d.filter((function(e){return!s||e.traded===!s})).map((function(e,c){return Object(O.jsxs)("li",{children:[Object(O.jsxs)("a",{href:"/product/".concat(e.id),children:[Object(O.jsx)("div",{className:"img",children:Object(O.jsx)("img",{src:e.imgUrl,alt:e.name})}),Object(O.jsx)("h3",{children:e.name}),Object(O.jsxs)("div",{className:"price",children:[Object(O.jsx)("span",{className:"unit",children:"\uffe5"}),Object(O.jsx)("span",{className:"value",children:e.price})]}),e.traded&&Object(O.jsx)("span",{className:"had",children:Object(O.jsx)("b",{children:t&&t.userType===h.BUYER?"\u5df2\u8d2d\u4e70":"\u5df2\u552e\u51fa"})})]}),t&&t.userType===h.SELLER&&s?Object(O.jsx)("button",{onClick:(n=e.id,function(){window.confirm("\u786e\u8ba4\u5220\u9664\u8be5\u5546\u54c1\uff1f")&&b.delete(n).then((function(){var e,t=[],c=Object(u.a)(d);try{for(c.s();!(e=c.n()).done;){var a=e.value;a.id!==n&&t.push(a)}}catch(s){c.e(s)}finally{c.f()}o(t)}))}),children:"\u5220\u9664"}):""]},c);var n}))})})]})},x=c(2),m={list:function(){return o.a.get("/cart",{withCredentials:!0}).then((function(e){return e.data}))},editCart:function(e){return o.a.post("/cart",e,{withCredentials:!0}).then((function(e){return e.data}))},checkout:function(){return o.a.get("/cart/checkout",{withCredentials:!0}).then((function(e){return e.data}))}};c(58);var f=function(e){var t=e.user,c=Object(j.g)().productId,a=Object(n.useState)({}),s=Object(i.a)(a,2),r=s[0],l=s[1],u=Object(n.useState)(0),d=Object(i.a)(u,2),o=d[0],p=d[1];function f(){var e=Object(x.a)(Object(x.a)({productId:c},r),{},{description:null,count:o});m.editCart(e).then((function(e){return console.log(e)||window.alert("\u6dfb\u52a0\u6210\u529f")})).catch((function(e){return console.log(e)||window.alert("\u6dfb\u52a0\u5931\u8d25")}))}function v(){return[Object(O.jsx)("button",{className:"cart-btn",onClick:f,children:"\u6dfb\u52a0\u81f3\u8d2d\u7269\u8f66"}),r.traded?Object(O.jsxs)("span",{children:["\u5df2\u8d2d\u4e70\u5f53\u65f6\u8d2d\u4e70\u4ef7\u683c\uff1a\uffe5",r.price]},"old-price"):null]}function g(){return Object(O.jsx)("a",{href:"/publish/".concat(r.productId),children:"\u7f16\u8f91"})}return Object(n.useEffect)((function(){document.title="\u5546\u54c1\u8be6\u60c5",b.getProductDetail(c).then((function(e){return l(e.data)}))}),[]),Object(O.jsxs)("div",{className:"p-container",children:[Object(O.jsxs)("div",{className:"wrapper",children:[Object(O.jsx)("div",{className:"img-container",children:Object(O.jsx)("img",{src:r.imgUrl})}),Object(O.jsxs)("div",{className:"cnt",children:[Object(O.jsx)("h2",{children:r.name}),Object(O.jsx)("span",{className:"abstract",children:r.productAbstract}),Object(O.jsxs)("div",{className:"price",children:[Object(O.jsx)("span",{className:"unit",children:"\uffe5"}),Object(O.jsx)("span",{className:"value",children:r.price})]}),Object(O.jsxs)("div",{className:"num",children:[Object(O.jsx)("span",{children:"\u8d2d\u4e70\u6570\u91cf\uff1a"}),Object(O.jsx)("input",{type:"number",value:o,onChange:function(e){return p(e.target.value)}})]}),Object(O.jsx)("div",{children:t&&t.userType===h.BUYER?Object(O.jsx)(v,{}):Object(O.jsx)(g,{})})]})]}),Object(O.jsxs)("div",{className:"full-desc",children:[Object(O.jsx)("div",{className:"desc-title",children:Object(O.jsx)("h2",{children:"\u8be6\u7ec6\u4fe1\u606f"})}),Object(O.jsx)("div",{className:"detail",children:r.description})]})]})},v={list:function(){return o.a.get("/account",{withCredentials:!0}).then((function(e){return e.data}))}};c(63);function g(e){var t=e.item,c=Object(j.f)();return Object(O.jsxs)("li",{className:"item",onClick:function(){return c.push("/product/".concat(t.productId))},children:[Object(O.jsx)("img",{src:t.imgUrl,className:"p-img"}),Object(O.jsxs)("div",{className:"p-container",children:[Object(O.jsx)("h4",{children:t.productName}),Object(O.jsx)("span",{className:"abstract",children:t.productAbstract}),Object(O.jsxs)("span",{className:"price",children:["\u5355\u4ef7: ",t.price]}),Object(O.jsx)("div",{className:"p-cnt",children:Object(O.jsxs)("span",{children:["\u6570\u91cf\uff1a",t.count]})})]})]})}var N=function(e){e.user;var t=Object(n.useState)([]),c=Object(i.a)(t,2),a=c[0],s=c[1];Object(n.useEffect)((function(){document.title="\u8d26\u6237",v.list().then((function(e){return s(e.data)}))}),[]);var r=a.map((function(e,t){return Object(O.jsx)(g,{item:e},t)}));return Object(O.jsxs)("div",{className:"account",children:[Object(O.jsx)("div",{className:"a-head",children:Object(O.jsx)("h2",{children:"\u5df2\u8d2d\u4e70\u7684\u5546\u54c1"})}),Object(O.jsx)("ul",{children:r})]})};c(64);var w=function(){var e=Object(j.f)(),t=Object(n.useState)({userId:null,cartItems:[],totalPrice:0}),c=Object(i.a)(t,2),a=c[0],s=c[1];function r(e){return function(t){var c=t.target.value;c<0&&(c=0),s(Object(x.a)(Object(x.a)({},a),{},{cartItems:a.cartItems.splice(e,1,Object(x.a)(Object(x.a)({},a.cartItems[e]),{},{count:c}))})),m.editCart(Object(x.a)(Object(x.a)({},a.cartItems[e]),{},{count:a.cartItems[e].count})).then((function(){var e,t=0,c=Object(u.a)(a.cartItems);try{for(c.s();!(e=c.n()).done;){var n=e.value;t+=n.count*n.price}}catch(r){c.e(r)}finally{c.f()}s(Object(x.a)(Object(x.a)({},a),{},{totalPrice:t}))})).catch((function(e){console.log(e),window.alert("\u66f4\u65b0\u5931\u8d25")}))}}return Object(n.useEffect)((function(){return m.list().then((function(e){s(e.data),document.title="\u8d2d\u7269\u8f66"}))}),[]),Object(O.jsxs)("div",{className:"cart",children:[Object(O.jsx)("div",{className:"c-head",children:Object(O.jsx)("h2",{children:"\u5df2\u6dfb\u52a0\u5230\u8d2d\u7269\u8f66\u7684\u5185\u5bb9"})}),Object(O.jsx)("ul",{children:a.cartItems&&a.cartItems.map((function(t,c){return Object(O.jsxs)("li",{className:"item",onClick:function(){return e.push("/product/".concat(t.productId))},children:[Object(O.jsx)("img",{src:t.imgUrl,className:"p-img"}),Object(O.jsxs)("div",{className:"p-container",children:[Object(O.jsx)("h4",{children:t.name}),Object(O.jsx)("span",{className:"abstract",children:t.productAbstract}),Object(O.jsxs)("span",{className:"price",children:["\u5355\u4ef7: \uffe5",t.price]}),Object(O.jsxs)("div",{className:"p-cnt",children:[Object(O.jsx)("span",{children:"\u6570\u91cf\uff1a"}),Object(O.jsx)("input",{type:"number",onChange:r(c),value:t.count})]})]})]},c)}))}),Object(O.jsxs)("div",{className:"cart-total",children:[Object(O.jsxs)("span",{className:"tot-price",children:["\u603b\u4ef7\uff1a\uffe5",a.totalPrice]}),Object(O.jsx)("br",{}),Object(O.jsx)("button",{className:"pay-btn",onClick:function(){m.checkout().then((function(){return s({cart:a,cartItems:[]})}))},children:"\u7ed3\u7b97"})]}),Object(O.jsx)("button",{className:"quit",onClick:function(){return e.go(-1)},children:"\u9000\u51fa"})]})},C=c(33),y=c.n(C),E={login:function(e){return o.a.post("/login",e,{withCredentials:!0}).then((function(e){return e.data}))},logout:function(){return o.a.get("/logout",{withCredentials:!0}).then((function(e){return e.data}))},getCurrentUser:function(){return o.a.get("/user",{withCredentials:!0}).then((function(e){return e.data}))}},S={SUCCESS:0,ERROR:-1};c(66);var I=function(){Object(j.f)();var e=Object(n.useState)(""),t=Object(i.a)(e,2),c=t[0],a=t[1],s=Object(n.useState)(""),r=Object(i.a)(s,2),l=r[0],u=r[1];return Object(n.useEffect)((function(){return document.title="\u767b\u5f55"}),[]),Object(O.jsx)("div",{className:"login",children:Object(O.jsxs)("form",{onSubmit:function(e){e.preventDefault();var t={};t.username=c,t.password=y()(l).toLowerCase(),c&&l?E.login(t).then((function(e){e.status==S.ERROR&&(window.alert("\u767b\u5f55\u5931\u8d25!\u8bf7\u68c0\u67e5\u7528\u6237\u540d\u6216\u5bc6\u7801"),u("")),window.location.href="/"})).catch((function(e){window.alert("\u672a\u77e5\u9519\u8bef")})):window.alert("\u7528\u6237\u540d\u6216\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a\uff01")},children:[Object(O.jsxs)("div",{className:"form-item",children:[Object(O.jsx)("span",{children:"\u7528\u6237\u540d:"}),Object(O.jsx)("input",{type:"form-item",value:c,name:"username",onChange:function(e){return a(e.target.value)}})]}),Object(O.jsxs)("div",{className:"form-item",children:[Object(O.jsx)("span",{children:"\u5bc6\u7801:"}),Object(O.jsx)("input",{type:"password",value:l,name:"password",onChange:function(e){return u(e.target.value)}})]}),Object(O.jsx)("input",{className:"sub-btn",type:"submit",value:"\u767b\u5f55"})]})})};c(67);var U=function(e){var t=Object(j.f)();e.user,Object(n.useEffect)((function(){return document.title="\u5546\u54c1\u53d1\u5e03"}),[]);var c=Object(j.g)().productId,a=Object(n.useState)({id:c,name:null,productAbstract:null,description:null,imgUrl:null,price:null}),s=Object(i.a)(a,2),r=s[0],l=s[1],u=Object(n.useState)(!0),d=Object(i.a)(u,2),h=d[0],p=d[1];return Object(n.useEffect)((function(){c&&""!==c&&b.getProductDetail(c).then((function(e){return l(e.data)}))}),[]),Object(O.jsxs)("div",{className:"p-pub",children:[Object(O.jsx)("div",{className:"head",children:Object(O.jsx)("h2",{children:"\u5185\u5bb9\u7f16\u8f91"})}),Object(O.jsxs)("form",{onSubmit:function(e){e.preventDefault();var c=r;b.editProduct(c).then((function(e){return t.push("/product/".concat(e.data))}))},children:[Object(O.jsxs)("div",{className:"edit-item",children:[Object(O.jsx)("span",{children:"\u6807\u9898\uff1a"}),Object(O.jsx)("input",{type:"text",name:"name",value:r.name?r.name:"",onChange:function(e){return l(Object(x.a)(Object(x.a)({},r),{},{name:e.target.value}))}})]}),Object(O.jsxs)("div",{className:"edit-item",children:[Object(O.jsx)("span",{children:"\u6458\u8981\uff1a"}),Object(O.jsx)("input",{type:"text",name:"productAbstract",value:r.productAbstract?r.productAbstract:"",onChange:function(e){return l(Object(x.a)(Object(x.a)({},r),{},{productAbstract:e.target.value}))}})]}),Object(O.jsxs)("div",{className:"edit-item",children:[Object(O.jsx)("span",{children:"\u56fe\u7247\uff1a"}),Object(O.jsxs)("div",{className:"inp-url",children:[Object(O.jsx)("input",{type:"radio",name:"pic",value:"url",checked:h,onChange:function(){return p(!0)}}),"\u56fe\u7247\u5730\u5740"]}),Object(O.jsxs)("div",{className:"inp-file",children:[Object(O.jsx)("input",{type:"radio",name:"pic",value:"file",onChange:function(){return p(!1)}}),"\u4e0a\u4f20\u56fe\u7247"]}),Object(O.jsx)("div",{style:{display:h?"block":"none"},children:Object(O.jsx)("input",{type:"text",name:"imgUrl",value:r.imgUrl?r.imgUrl:"",onChange:function(e){return l(Object(x.a)(Object(x.a)({},r),{},{imgUrl:e.target.value}))}})}),Object(O.jsxs)("div",{style:{display:h?"none":"block"},children:[Object(O.jsx)("input",{type:"file",name:"file",id:"file"}),Object(O.jsx)("button",{className:"upload-btn",onClick:function(e){e.preventDefault();var t=document.querySelector("#file").files[0];if(t.size/1024>1024)window.alert("\u4e0a\u4f20\u6587\u4ef6\u5927\u5c0f\u4e0d\u5f97\u8d85\u8fc71MB\uff01");else{var c=t.name;if(-1!==c.indexOf(".")){var n=c.split(".")[1];if(-1!==["jpg","png","gif"].indexOf(n)){var a=new FormData;a.append("file",t),o.a.post("/upload",a,{withCredentials:!0}).then((function(e){return console.log(e)||l(Object(x.a)(Object(x.a)({},r),{},{imgUrl:e.data.data.url}))}))}else window.alert("\u8bf7\u4e0a\u4f20\u56fe\u7247\u683c\u5f0f\u6587\u4ef6")}else window.alert("\u8bf7\u4e0a\u4f20\u56fe\u7247\u683c\u5f0f\u6587\u4ef6")}},children:"\u4e0a\u4f20"})]})]}),Object(O.jsxs)("div",{className:"edit-item",children:[Object(O.jsx)("span",{className:"desc",children:"\u6b63\u6587\uff1a"}),Object(O.jsx)("textarea",{name:"description",value:r.description?r.description:"",rows:"10",placeholder:"2-1000\u4e2a\u5b57\u7b26",onChange:function(e){return l(Object(x.a)(Object(x.a)({},r),{},{description:e.target.value}))}})]}),Object(O.jsxs)("div",{className:"edit-item",children:[Object(O.jsx)("span",{children:"\u4ef7\u683c\uff1a"}),Object(O.jsx)("input",{className:"price",type:"text",name:"price",value:r.price?r.price:"",onChange:function(e){return l(Object(x.a)(Object(x.a)({},r),{},{price:e.target.value}))}}),"\u5143"]}),Object(O.jsx)("input",{type:"submit",value:"\u4fdd\u5b58"})]})]})};c(68);var k=function(){var e=Object(n.useState)(null),t=Object(i.a)(e,2),c=t[0],a=t[1];return Object(n.useEffect)((function(){E.getCurrentUser().then((function(e){return a(e.data)}))}),[]),Object(O.jsxs)(l.a,{children:[c?Object(O.jsxs)("div",{className:"header",children:[Object(O.jsxs)("div",{className:"user",children:[c.userType&&c.userType!=h.BUYER?Object(O.jsx)("span",{children:"\u5356\u5bb6\u4f60\u597d"}):Object(O.jsx)("span",{children:"\u4e70\u5bb6\u4f60\u597d"}),Object(O.jsxs)("span",{children:["\uff0c"+c.username||!1,"!"]}),c.username?Object(O.jsx)("a",{onClick:function(e){e.preventDefault(),E.logout().then((function(e){return a(null)}))},href:"#",children:"[\u9000\u51fa]"}):Object(O.jsx)(l.b,{to:"/login",children:"[\u767b\u5f55]"})]}),Object(O.jsxs)("ul",{className:"nav",children:[Object(O.jsx)("li",{children:Object(O.jsx)("a",{href:"/",children:"\u9996\u9875"})},"index"),c.userType===h.BUYER?[Object(O.jsx)("li",{children:Object(O.jsx)(l.b,{to:"/account",children:"\u8d26\u52a1"})},"account"),Object(O.jsx)("li",{children:Object(O.jsx)(l.b,{to:"/cart",children:"\u8d2d\u7269\u8f66"})},"cart")]:Object(O.jsx)("li",{children:Object(O.jsx)(l.b,{to:"/publish",children:"\u53d1\u5e03"})},"publish")]})]}):Object(O.jsxs)("div",{className:"header",children:[Object(O.jsx)("div",{className:"user",children:Object(O.jsxs)("span",{children:["\u8bf7",Object(O.jsx)(l.b,{to:"/login",children:"[\u767b\u5f55]"})]})}),Object(O.jsx)("ul",{className:"nav",children:Object(O.jsx)("li",{children:Object(O.jsx)(l.b,{to:"/",children:"\u9996\u9875"})})})]}),Object(O.jsxs)(j.c,{children:[Object(O.jsx)(j.a,{path:"/",exact:!0,children:Object(O.jsx)(p,{user:c})}),Object(O.jsx)(j.a,{path:"/login",children:Object(O.jsx)(I,{})}),Object(O.jsx)(j.a,{path:"/product/:productId",children:Object(O.jsx)(f,{user:c})}),Object(O.jsx)(j.a,{path:"/cart",children:Object(O.jsx)(w,{user:c})}),Object(O.jsx)(j.a,{path:"/account",exact:!0,children:Object(O.jsx)(N,{user:c})}),Object(O.jsx)(j.a,{path:"/publish/:productId",children:Object(O.jsx)(U,{user:c})}),Object(O.jsx)(j.a,{path:"/publish",exact:!0,children:Object(O.jsx)(U,{user:c})})]})]})};r.a.render(Object(O.jsx)(a.a.StrictMode,{children:Object(O.jsx)(k,{})}),document.getElementById("main"))}},[[69,1,2]]]);
//# sourceMappingURL=index.7caf50af.chunk.js.map